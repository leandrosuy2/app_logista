{% extends 'base.html' %}

{% block content %}
<style>
.card-equal {
    height: 100%;
}
.card-body {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
}
.row.g-3 {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
}
</style>

<div class="container mt-4">
    <div class="row g-3">
        <!-- Card Pendentes -->
        <div class="col-lg-3 col-md-6">
            <div class="card shadow border-0 card-equal" style="background: linear-gradient(135deg, #1abb9c, #16a085);">
                <div class="card-body text-white d-flex flex-column justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold">Pendentes</h5>
                        <p class="fs-2 mb-0 count-number" data-count="{{ titulos_pendentes }}">0</p>
                    </div>
                    <i class="fas fa-file-alt fa-4x opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Card Quitados -->
        <div class="col-lg-3 col-md-6">
            <div class="card shadow border-0 card-equal" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                <div class="card-body text-white d-flex flex-column justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold">Quitados</h5>
                        <p class="fs-2 mb-0 count-number" data-count="{{ titulos_quitados }}">0</p>
                    </div>
                    <i class="fas fa-check-circle fa-4x opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Card Negociados -->
        <div class="col-lg-3 col-md-6">
            <div class="card shadow border-0 card-equal" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                <div class="card-body text-white d-flex flex-column justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold">Negociados</h5>
                        <p class="fs-2 mb-0 count-number" data-count="{{ titulos_negociados }}">0</p>
                    </div>
                    <i class="fas fa-handshake fa-4x opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Card Total de Clientes -->
        <div class="col-lg-3 col-md-6">
            <div class="card shadow border-0 card-equal" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                <div class="card-body text-white d-flex flex-column justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold">Total de Clientes</h5>
                        <p class="fs-2 mb-0 count-number" data-count="{{ total_clientes }}">0</p>
                    </div>
                    <i class="fas fa-users fa-4x opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Card Negociados em Atraso -->
        <div class="col-lg-3 col-md-6">
            <div class="card shadow border-0 card-equal" style="background: linear-gradient(135deg, #ff6f61, #d9534f);">
                <div class="card-body text-white d-flex flex-column justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold">Negociados em Atraso</h5>
                        <p class="fs-2 mb-0 count-number" data-count="{{ negociados_em_atraso_count }}">0</p>
                    </div>
                    <i class="fas fa-exclamation-circle fa-4x opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Card Quitados Hoje -->
        <div class="col-lg-3 col-md-6">
            <div class="card shadow border-0 card-equal" style="background: linear-gradient(135deg, #3498db, #2980b9);" data-bs-toggle="modal" data-bs-target="#modalQuitadosHoje">
                <div class="card-body text-white d-flex flex-column justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold">Quitados Hoje</h5>
                        <p class="fs-2 mb-0">R$ {{ quitados_hoje|floatformat:2 }}</p>
                    </div>
                    <i class="fas fa-check-circle fa-4x opacity-75"></i>
                </div>
            </div>
        </div>

        <!-- Card Negociados Hoje -->
        <div class="col-lg-3 col-md-6">
            <div class="card shadow border-0 card-equal" style="background: linear-gradient(135deg, #34495e, #2c3e50);" data-bs-toggle="modal" data-bs-target="#modalNegociadosHoje">
                <div class="card-body text-white d-flex flex-column justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold">Negociados Hoje</h5>
                        <p class="fs-2 mb-0">R$ {{ negociados_hoje|floatformat:2 }}</p>
                    </div>
                    <i class="fas fa-handshake fa-4x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Script para contagem animada -->
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const counters = document.querySelectorAll('.count-number');
        counters.forEach(counter => {
            const target = Number(counter.getAttribute('data-count') || 0);
            const updateCount = () => {
                const current = Number(counter.innerText) || 0;
                const increment = Math.max(1, Math.ceil(target / 100));
                if (current < target) {
                    counter.innerText = Math.min(current + increment, target);
                    setTimeout(updateCount, 20);
                } else {
                    counter.innerText = target;
                }
            };
            updateCount();
        });
    });
    </script>

    <!-- Modal para Quitados Hoje -->
    <div class="modal fade" id="modalQuitadosHoje" tabindex="-1" aria-labelledby="modalQuitadosHojeLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalQuitadosHojeLabel">Detalhes dos Quitados Hoje</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% if quitados_hoje_detalhes %}
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>CPF/CNPJ</th>
                                    <th>Empresa</th>
                                    <th>Data de Baixa</th>
                                    <th>Valor Recebido</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in quitados_hoje_detalhes %}
                                    <tr>
                                        <td>{{ item.nome }}</td>
                                        <td>{{ item.cpf_cnpj }}</td>
                                        <td>{{ item.nome_fantasia }}</td>
                                        <td>{{ item.data_baixa }}</td>
                                        <td>{{ item.valorRecebido }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>N√£o h√° t√≠tulos quitados hoje.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById('modalQuitadosHoje');
        modal.addEventListener('show.bs.modal', function () {
            const modalBody = modal.querySelector('.modal-body');
            modalBody.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Carregando...</span></div></div>';

            // Dados do contexto do Django (string JSON segura)
            const quitadosHojeDetalhes = JSON.parse('{{ quitados_hoje_detalhes|escapejs }}');

            if (quitadosHojeDetalhes.length > 0) {
                let htmlContent = `
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF/CNPJ</th>
                                <th>Empresa</th>
                                <th>Data de Baixa</th>
                                <th>Valor Recebido</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                quitadosHojeDetalhes.forEach(item => {
                    htmlContent += `
                        <tr>
                            <td>${item.nome}</td>
                            <td>${item.cpf_cnpj || 'N√£o informado'}</td>
                            <td>${item.nome_fantasia}</td>
                            <td>${item.data_baixa}</td>
                            <td>${item.valorRecebido}</td>
                        </tr>
                    `;
                });
                htmlContent += '</tbody></table>';
                modalBody.innerHTML = htmlContent;
            } else {
                modalBody.innerHTML = '<p>N√£o h√° t√≠tulos quitados hoje.</p>';
            }
        });
    });
    </script>

    <!-- Modal para Negociados Hoje -->
    <div class="modal fade" id="modalNegociadosHoje" tabindex="-1" aria-labelledby="modalNegociadosHojeLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalNegociadosHojeLabel">Detalhes dos Negociados Hoje</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% if negociados_hoje_detalhes %}
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>CPF/CNPJ</th>
                                    <th>Empresa</th>
                                    <th>Data de Negocia√ß√£o</th>
                                    <th>Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in negociados_hoje_detalhes %}
                                    <tr>
                                        <td>{{ item.nome }}</td>
                                        <td>{{ item.cpf_cnpj }}</td>
                                        <td>{{ item.nome_fantasia }}</td>
                                        <td>{{ item.data_negociacao }}</td>
                                        <td>{{ item.valor }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>N√£o h√° t√≠tulos negociados hoje.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const modalNegociadosHoje = document.getElementById('modalNegociadosHoje');
        modalNegociadosHoje.addEventListener('show.bs.modal', function () {
            const modalBody = modalNegociadosHoje.querySelector('.modal-body');
            modalBody.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Carregando...</span></div></div>';

            const negociadosHojeDetalhes = JSON.parse('{{ negociados_hoje_detalhes|escapejs }}');
            if (negociadosHojeDetalhes.length > 0) {
                let htmlContent = `
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF/CNPJ</th>
                                <th>Empresa</th>
                                <th>Data de Negocia√ß√£o</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                negociadosHojeDetalhes.forEach(item => {
                    htmlContent += `
                        <tr>
                            <td>${item.nome}</td>
                            <td>${item.cpf_cnpj || 'N√£o informado'}</td>
                            <td>${item.nome_fantasia}</td>
                            <td>${item.data_negociacao}</td>
                            <td>${item.valor}</td>
                        </tr>
                    `;
                });
                htmlContent += '</tbody></table>';
                modalBody.innerHTML = htmlContent;
            } else {
                modalBody.innerHTML = '<p>N√£o h√° t√≠tulos negociados hoje.</p>';
            }
        });
    });
    </script>

    <!-- Busca -->
    <form method="get" action="{% url 'dashboard' %}" class="mb-4 p-3 shadow rounded bg-light">
        <div class="input-group">
            <input type="text" name="query" class="form-control border-primary fs-5" placeholder="üîç Buscar por nome, CPF, CNPJ, Nome Fantasia,  etc." value="{{ query }}" style="box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);">
            <button type="submit" class="btn btn-primary fs-5 px-4" style="background: linear-gradient(135deg, #007bff, #0056b3); box-shadow: 0 4px 10px rgba(0, 123, 255, 0.5);">
                Buscar
            </button>
        </div>
    </form>

    <!-- Agenda de trabalho do dia - Pendentes -->
    <h2 class="mt-4">Agenda de trabalho do dia - Pendentes</h2>
    <table class="table table-hover table-bordered mt-3" style="font-size: 0.8rem;">
        <thead class="table-dark">
            <tr>
                <th>Devedor</th>
                <th>Credor</th>
                <th>Nome da M√£e</th>
                <th>CPF/CNPJ</th>
                <th class="text-center">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for item in agenda_pendentes_paginated %}
            <tr>
                <td><b>{{ item.nome }}</b></td>
                <td><b>{{ item.nome_fantasia_credor }}</b></td>
                <td><b>{{ item.nome_mae }}</b></td>
                <td><b>
                    {% if item.cpf %}
                        {{ item.cpf }}
                    {% elif item.cnpj %}
                        {{ item.cnpj }}
                    {% else %}
                        N√£o informado
                    {% endif %}
                    </b>
                </td>
                <td class="text-center">
                    <a href="{% url 'detalhes_devedor' item.id %}" target="_blank" class="btn btn-sm btn-info">Visualizar</a>
                    <a href="{% url 'realizar_baixa' item.id %}" class="btn btn-success btn-sm">Baixar</a>

                    <!-- NOVO: Follow-ups -->
                    <button type="button"
                            class="btn btn-sm btn-secondary"
                            data-bs-toggle="modal"
                            data-bs-target="#modalFollowUps"
                            data-devedor="{{ item.devedor_id }}"
                            data-nome="{{ item.nome|escape }}">
                      Follow-ups
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Agendamentos pendentes -->
    <h2 class="mt-4">Agendamentos pendentes</h2>
    {% if agendamentos_hoje %}
    <table class="table table-hover table-bordered align-middle mt-3" style="font-size: 0.8rem;">
        <thead class="table-dark">
            <tr>
                <th>Devedor</th>
                <th>CPF / CNPJ</th>
                <th>Empresa</th>
                <th>Telefone</th>
                <th>Data de Retorno</th>
                <th>Operador</th>
                <th class="text-center">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for agendamento in agendamentos_hoje %}
            <tr>
                <td><b>{{ agendamento.devedor__nome }}</b></td>
                <td><b>
                    {% if agendamento.devedor__cpf %}
                        {{ agendamento.devedor__cpf }}
                    {% elif agendamento.devedor__cnpj %}
                        {{ agendamento.devedor__cnpj }}
                    {% else %}
                        N√£o informado
                    {% endif %}
                </b></td>
                <td><b>{{ agendamento.empresa__nome_fantasia }}</b></td>
                <td class="text-center"><b>
                    {% if agendamento.telefone_formatado %}
                        <a href="https://wa.me/{{ agendamento.telefone_formatado }}" target="_blank" class="btn btn-success d-flex align-items-center">
                            <i class="fab fa-whatsapp me-2"></i>
                            {{ agendamento.telefone_formatado }}
                        </a>
                    {% endif %}
                </b></td>
                <td><b>{{ agendamento.data_retorno|date:"d/m/Y H:i" }}</b></td>
                <td><b>{{ agendamento.operador }}</b></td>
                <td class="text-center">
                    <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#modalAgendamento{{ agendamento.id }}">
                        Visualizar
                    </button>

                    <!-- NOVO: Follow-ups -->
                    <button type="button"
                            class="btn btn-sm btn-secondary"
                            data-bs-toggle="modal"
                            data-bs-target="#modalFollowUps"
                            data-devedor="{{ agendamento.devedor_id }}"
                            data-nome="{{ agendamento.devedor__nome|escape }}">
                      Follow-ups
                    </button>
                </td>
            </tr>

            <!-- Modal Agendamento (existente) -->
            <div class="modal fade" id="modalAgendamento{{ agendamento.id }}" tabindex="-1" aria-labelledby="modalLabel{{ agendamento.id }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title" id="modalLabel{{ agendamento.id }}">Detalhes do Agendamento</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p><strong>Devedor:</strong> {{ agendamento.devedor__nome }}</p>
                            <p><strong>CPF:</strong> {{ agendamento.devedor__cpf|default:"N√£o informado" }}</p>
                            <p><strong>Empresa:</strong> {{ agendamento.empresa__nome_fantasia }}</p>
                            <p><strong>Telefone:</strong> {{ agendamento.telefone|default:"N√£o informado" }}</p>
                            <p><strong>Data de Abertura:</strong> {{ agendamento.data_abertura|date:"d/m/Y H:i" }}</p>
                            <p><strong>Data de Retorno:</strong> {{ agendamento.data_retorno|date:"d/m/Y H:i" }}</p>
                            <p><strong>Operador:</strong> {{ agendamento.operador }}</p>
                            <p><strong>Status:</strong>
                                <span class="badge {% if agendamento.status == 'Finalizado' %}bg-success{% else %}bg-warning text-dark{% endif %}">
                                    {{ agendamento.status }}
                                </span>
                            </p>
                            <p><strong>Assunto:</strong> {{ agendamento.assunto|default:"N√£o informado" }}</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted small">Nenhum agendamento para hoje.</p>
    {% endif %}

    <!-- Negociados em atraso -->
    <h2 class="mt-4">Negociados em atraso</h2>
    {% if negociados_paginated %}
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Devedor</th>
                <th>Empresa</th>
                <th>Data de Vencimento</th>
                <th>Valor</th>
                <th>Status</th>
                <th class="text-center">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for titulo in negociados_paginated %}
            <tr>
                <td>{{ titulo.devedor_nome }}</td>
                <td>{{ titulo.empresa_nome }}</td>
                <td>{{ titulo.data_vencimento|date:"d/m/Y" }}</td>
                <td>R$ {{ titulo.valor_total|floatformat:2 }}</td>
                <td><span class="badge bg-warning">Negociado em atraso</span></td>
                <td class="text-center">
                    <a href="{% url 'detalhes_devedor' titulo.id %}" target="_blank" class="btn btn-sm btn-info">Visualizar</a>

                    <!-- NOVO: Follow-ups -->
                    <button type="button"
                            class="btn btn-sm btn-secondary"
                            data-bs-toggle="modal"
                            data-bs-target="#modalFollowUps"
                            data-devedor="{{ titulo.devedor_id }}"
                            data-nome="{{ titulo.devedor_nome|escape }}">
                      Follow-ups
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagina√ß√£o -->
    <div class="mt-3">
        <nav>
            <ul class="pagination justify-content-center">
                {% if negociados_paginated.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page_negociados={{ negociados_paginated.previous_page_number }}">Anterior</a>
                </li>
                {% endif %}

                <li class="page-item">
                    <a class="page-link" href="#">P√°gina {{ negociados_paginated.number }} de {{ negociados_paginated.paginator.num_pages }}</a>
                </li>

                {% if negociados_paginated.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page_negociados={{ negociados_paginated.next_page_number }}">Pr√≥xima</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% else %}
    <p class="text-muted">Nenhum t√≠tulo negociado em atraso encontrado.</p>
    {% endif %}

    <!-- (Os modais de parcela/baixa que voc√™ tinha podem permanecer aqui, se aplic√°veis ao contexto) -->

    <!-- √öltimos clientes cadastrados -->
    <h2 class="mt-4">√öltimos Clientes Cadastrados</h2>
    <table class="table table-striped table-bordered mt-3" style="font-size: 0.8rem;">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>CPF/CNPJ</th>
                <th>Data de Cadastro</th>
            </tr>
        </thead>
        <tbody>
            {% for cliente in ultimos_clientes %}
            <tr>
                <td><b>{{ cliente.id }}</b></td>
                <td><b>{{ cliente.nome }}</b></td>
                <td><b>{% if cliente.cpf %}{{ cliente.cpf }}{% elif cliente.cnpj %}{{ cliente.cnpj }}{% else %}N√£o informado{% endif %}</b></td>
                <td><b>{{ cliente.created_at|date:"d/m/Y" }}</b></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ================== MODAL REUTILIZ√ÅVEL DE FOLLOW-UPS ================== -->
<div class="modal fade" id="modalFollowUps" tabindex="-1" aria-labelledby="modalFollowUpsLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-secondary text-white">
        <h5 class="modal-title" id="modalFollowUpsLabel">Follow-ups</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <div id="fuLoading" class="text-center py-4">
          <div class="spinner-border" role="status"></div>
          <div class="small mt-2">Carregando‚Ä¶</div>
        </div>
        <ul id="fuList" class="list-group d-none"></ul>
        <div id="fuEmpty" class="alert alert-light border d-none">Nenhum follow-up para este devedor.</div>
      </div>
      <div class="modal-footer">
        <button id="fuVerMais" type="button" class="btn btn-outline-secondary d-none">Ver mais</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<script>
(function () {
  const modal = document.getElementById('modalFollowUps');
  const fuList = document.getElementById('fuList');
  const fuLoading = document.getElementById('fuLoading');
  const fuEmpty = document.getElementById('fuEmpty');
  const fuVerMais = document.getElementById('fuVerMais');

  let currentDevedor = null;
  let currentLimit = 50;

  function escapeHTML(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;');}

  async function loadFollowUps(devedorId, limit){
    fuLoading.classList.remove('d-none');
    fuList.classList.add('d-none');
    fuEmpty.classList.add('d-none');
    fuVerMais.classList.add('d-none');

    try{
      const base = "{% url 'followups_devedor_json' 0 %}";
      const url = base.replace('/0/', `/${devedorId}/`) + `?limit=${limit}`;
      const res = await fetch(url, { headers: { 'X-Requested-With': 'fetch' }});
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();

      fuList.innerHTML = '';
      if (!data.items || !data.items.length){
        fuEmpty.classList.remove('d-none');
      } else {
        const frag = document.createDocumentFragment();
        data.items.forEach(it => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.innerHTML = `<p class="mb-1"><strong>${escapeHTML(it.created_at)}:</strong></p><div style="white-space:pre-wrap">${escapeHTML(it.texto)}</div>`;
          frag.appendChild(li);
        });
        fuList.appendChild(frag);
        fuList.classList.remove('d-none');

        // Mostra "ver mais" quando bate no limite atual
        if (data.items.length >= limit) {
          fuVerMais.classList.remove('d-none');
        }
      }
    } catch(e){
      fuEmpty.textContent = 'Falha ao carregar os follow-ups.';
      fuEmpty.classList.remove('d-none');
    } finally {
      fuLoading.classList.add('d-none');
    }
  }

  modal.addEventListener('show.bs.modal', (ev) => {
    const btn = ev.relatedTarget;
    currentDevedor = btn?.getAttribute('data-devedor');
    currentLimit = 50;

    const nome = btn?.getAttribute('data-nome') || 'Follow-ups';
    document.getElementById('modalFollowUpsLabel').textContent = `Follow-ups ‚Äî ${nome}`;

    if (currentDevedor) {
      loadFollowUps(currentDevedor, currentLimit);
    } else {
      fuLoading.classList.add('d-none');
      fuEmpty.textContent = 'Devedor n√£o identificado.';
      fuEmpty.classList.remove('d-none');
    }
  });

  fuVerMais.addEventListener('click', () => {
    currentLimit += 100;
    if (currentDevedor) loadFollowUps(currentDevedor, currentLimit);
  });
})();
</script>

{% endblock %}
